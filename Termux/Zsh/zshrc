# Path to your oh-my-zsh installation.
export ZSH=$HOME/.oh-my-zsh
 
# Set name of the theme to load.
# Look in ~/.oh-my-zsh/themes/
# Optionally, if you set this to "random", it'll load a random theme each
# time that oh-my-zsh is loaded.
#ZSH_THEME="agnoster"
 
POWERLEVEL9K_LEFT_PROMPT_ELEMENTS=(dir vcs pyenv)
POWERLEVEL9K_MODE='nerdfont-complete'
POWERLEVEL9K_PROMPT_ON_NEWLINE=true
POWERLEVEL9K_LEFT_SEGMENT_SEPARATOR=''
POWERLEVEL9K_RIGHT_SEGMENT_SEPARATOR=''
POWERLEVEL9K_LEFT_SUBSEGMENT_SEPARATOR=''
POWERLEVEL9K_RIGHT_SUBSEGMENT_SEPARATOR=''
POWERLEVEL9K_MULTILINE_FIRST_PROMPT_PREFIX="%F{blue}\u256D\u2500%F{white}"
POWERLEVEL9K_MULTILINE_LAST_PROMPT_PREFIX="%F{blue}\u2570\uf460%F{white} "
POWERLEVEL9K_LEFT_PROMPT_ELEMENTS=(root_indicator dir dir_writable_joined)
POWERLEVEL9K_RIGHT_PROMPT_ELEMENTS=(command_execution_time
                                    vcs background_jobs_joined time_joined)
POWERLEVEL9K_VCS_MODIFIED_BACKGROUND="clear"
POWERLEVEL9K_VCS_UNTRACKED_BACKGROUND="clear"
POWERLEVEL9K_VCS_MODIFIED_FOREGROUND="yellow"
POWERLEVEL9K_VCS_UNTRACKED_FOREGROUND="yellow"
POWERLEVEL9K_DIR_HOME_BACKGROUND="clear"
POWERLEVEL9K_DIR_HOME_FOREGROUND="blue"
POWERLEVEL9K_DIR_HOME_SUBFOLDER_BACKGROUND="clear"
POWERLEVEL9K_DIR_HOME_SUBFOLDER_FOREGROUND="blue"
POWERLEVEL9K_DIR_WRITABLE_FORBIDDEN_BACKGROUND="clear"
POWERLEVEL9K_DIR_WRITABLE_FORBIDDEN_FOREGROUND="red"
POWERLEVEL9K_DIR_DEFAULT_BACKGROUND="clear"
POWERLEVEL9K_DIR_DEFAULT_FOREGROUND="white"
POWERLEVEL9K_ROOT_INDICATOR_BACKGROUND="red"
POWERLEVEL9K_ROOT_INDICATOR_FOREGROUND="white"
POWERLEVEL9K_STATUS_OK_BACKGROUND="clear"
POWERLEVEL9K_STATUS_OK_FOREGROUND="green"
POWERLEVEL9K_STATUS_ERROR_BACKGROUND="clear"
POWERLEVEL9K_STATUS_ERROR_FOREGROUND="red"
POWERLEVEL9K_TIME_BACKGROUND="clear"
POWERLEVEL9K_TIME_FOREGROUND="cyan"
POWERLEVEL9K_COMMAND_EXECUTION_TIME_BACKGROUND='clear'
POWERLEVEL9K_COMMAND_EXECUTION_TIME_FOREGROUND='magenta'
POWERLEVEL9K_BACKGROUND_JOBS_BACKGROUND='clear'
POWERLEVEL9K_BACKGROUND_JOBS_FOREGROUND='green'
 
 
# Example aliases
# alias zshconfig="mate ~/.zshrc"
# alias ohmyzsh="mate ~/.oh-my-zsh"
alias vs="code ."
alias vitan="hexo clean && hexo g && hexo s"
alias blog="cd blog && vs"
alias tnew='tmux new -s'
alias update='apt update && apt upgrade'
alias cp='cp -i'
alias mv='mv -i'
alias rm='rm -i'
alias ls='ls -F --color=auto'
alias ll='ls -al'
alias grep='grep --color=auto'
alias la='ls -a'
#alias pacman='sudo pacman-color'
#alias p='sudo pacman-color'
#alias y='yaourt'
alias h='htop'
 
# Uncomment the following line to use case-sensitive completion.
# CASE_SENSITIVE="true"
 
# Uncomment the following line to disable bi-weekly auto-update checks.
# DISABLE_AUTO_UPDATE="true"
 
# Uncomment the following line to change how often to auto-update (in days).
# export UPDATE_ZSH_DAYS=13
 
# Uncomment the following line to disable colors in ls.
# DISABLE_LS_COLORS="true"
 
# Uncomment the following line to disable auto-setting terminal title.
# DISABLE_AUTO_TITLE="true"
 
# Uncomment the following line to disable command auto-correction.
# DISABLE_CORRECTION="true"
 
# Uncomment the following line to display red dots whilst waiting for completion.
# COMPLETION_WAITING_DOTS="true"
 
# Uncomment the following line if you want to disable marking untracked files
# under VCS as dirty. This makes repository status check for large repositories
# much, much faster.
# DISABLE_UNTRACKED_FILES_DIRTY="true"
 
# Uncomment the following line if you want to change the command execution time
# stamp shown in the history command output.
# The optional three formats: "mm/dd/yyyy"|"dd.mm.yyyy"|"yyyy-mm-dd"
# HIST_STAMPS="mm/dd/yyyy"
 
# Would you like to use another custom folder than $ZSH/custom?
# ZSH_CUSTOM=/path/to/new-custom-folder
 
# Which plugins would you like to load? (plugins can be found in ~/.oh-my-zsh/plugins/*)
# Custom plugins may be added to ~/.oh-my-zsh/custom/plugins/
# Example format: plugins=(rails git textmate ruby lighthouse)
#plugins=(git autojump zsh-autosuggestions vi-mode)
 
#source $ZSH/oh-my-zsh.sh
 
# User configuration
#export PATH=$HOME/bin:/usr/local/bin:$PATH
# export MANPATH="/usr/local/man:$MANPATH"
#export PATH="/bin:/usr/bin:/sbin:/usr/sbin:/usr/local/bin"
 
# You may need to manually set your language environment
export LANG=en_US.UTF-8
export PYTHONIOENCODING=UTF-8    # for python
export PYTEST_ADDOPTS="--color=yes"    # py.test color output
 
# Preferred editor for local and remote sessions
 if [[ -n $SSH_CONNECTION ]]; then
   export EDITOR='vim'
 else
   export EDITOR='nvim'
 fi
 
# fzf config, must sudo pacman install fzf
[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh
 
# the fuck config, must pacman install thefuck
#eval $(thefuck --alias)
 
# Compilation flags
# export ARCHFLAGS="-arch x86_64"

#ÁºñËæëÂô®
export EDITOR=vim

#ËæìÂÖ•Ê≥ï
export XMODIFIERS="@im=ibus"
export QT_MODULE=ibus
export GTK_MODULE=ibus

#ÂÖ≥‰∫éÂéÜÂè≤Á∫™ÂΩïÁöÑÈÖçÁΩÆ {{{
#ÂéÜÂè≤Á∫™ÂΩïÊù°ÁõÆÊï∞Èáè
export HISTSIZE=10000
#Ê≥®ÈîÄÂêé‰øùÂ≠òÁöÑÂéÜÂè≤Á∫™ÂΩïÊù°ÁõÆÊï∞Èáè
export SAVEHIST=10000

#ÂéÜÂè≤Á∫™ÂΩïÊñá‰ª∂
export HISTFILE=~/.zhistory
#‰ª•ÈôÑÂä†ÁöÑÊñπÂºèÂÜôÂÖ•ÂéÜÂè≤Á∫™ÂΩï
setopt INC_APPEND_HISTORY
#Â¶ÇÊûúËøûÁª≠ËæìÂÖ•ÁöÑÂëΩ‰ª§Áõ∏ÂêåÔºåÂéÜÂè≤Á∫™ÂΩï‰∏≠Âè™‰øùÁïô‰∏Ä‰∏™
setopt HIST_IGNORE_DUPS
#‰∏∫ÂéÜÂè≤Á∫™ÂΩï‰∏≠ÁöÑÂëΩ‰ª§Ê∑ªÂä†Êó∂Èó¥Êà≥
setopt EXTENDED_HISTORY

#ÂêØÁî® cd ÂëΩ‰ª§ÁöÑÂéÜÂè≤Á∫™ÂΩïÔºåcd -[TAB]ËøõÂÖ•ÂéÜÂè≤Ë∑ØÂæÑ
setopt AUTO_PUSHD
#Áõ∏ÂêåÁöÑÂéÜÂè≤Ë∑ØÂæÑÂè™‰øùÁïô‰∏Ä‰∏™
setopt PUSHD_IGNORE_DUPS

#Âú®ÂëΩ‰ª§ÂâçÊ∑ªÂä†Á©∫Ê†ºÔºå‰∏çÂ∞ÜÊ≠§ÂëΩ‰ª§Ê∑ªÂä†Âà∞Á∫™ÂΩïÊñá‰ª∂‰∏≠
#setopt HIST_IGNORE_SPACE
#}}}

#ÊØè‰∏™ÁõÆÂΩï‰ΩøÁî®Áã¨Á´ãÁöÑÂéÜÂè≤Á∫™ÂΩï{{{
cd() {
builtin cd "$@"                             # do actual cd
fc -W                                       # write current history  file
local HISTDIR="$HOME/.zsh_history$PWD"      # use nested folders for history
if  [ ! -d "$HISTDIR" ] ; then          # create folder if needed
mkdir -p "$HISTDIR"
fi
export HISTFILE="$HISTDIR/zhistory"     # set new history file
touch $HISTFILE
local ohistsize=$HISTSIZE
HISTSIZE=0                              # Discard previous dir's history
HISTSIZE=$ohistsize                     # Prepare for new dir's history
fc -R                                       #read from current histfile
}
mkdir -p $HOME/.zsh_history$PWD
export HISTFILE="$HOME/.zsh_history$PWD/zhistory"

function allhistory { cat $(find $HOME/.zsh_history -name zhistory) }
function convhistory {
sort $1 | uniq |
sed 's/^:\([ 0-9]*\):[0-9]*;\(.*\)/\1::::::\2/' |
awk -F"::::::" '{ $1=strftime("%Y-%m-%d %T",$1) "|"; print }'
}
#‰ΩøÁî® histall ÂëΩ‰ª§Êü•ÁúãÂÖ®ÈÉ®ÂéÜÂè≤Á∫™ÂΩï
function histall { convhistory =(allhistory) |
sed '/^.\{20\} *cd/i\\' }
#‰ΩøÁî® hist Êü•ÁúãÂΩìÂâçÁõÆÂΩïÂéÜÂè≤Á∫™ÂΩï
function hist { convhistory $HISTFILE }

#ÂÖ®ÈÉ®ÂéÜÂè≤Á∫™ÂΩï top50
function top50 { allhistory | awk -F':[ 0-9]*:[0-9]*;' '{ $1="" ; print }' | sed 's/ /\n/g' | sed '/^$/d' | sort | uniq -c | sort -nr | head -n 50 }

#}}}

#ÊùÇÈ°π {{{
#ÂÖÅËÆ∏Âú®‰∫§‰∫íÊ®°Âºè‰∏≠‰ΩøÁî®Ê≥®Èáä  ‰æãÂ¶ÇÔºö
#cmd #ËøôÊòØÊ≥®Èáä
setopt INTERACTIVE_COMMENTS

#ÂêØÁî®Ëá™Âä® cdÔºåËæìÂÖ•ÁõÆÂΩïÂêçÂõûËΩ¶ËøõÂÖ•ÁõÆÂΩï
#Á®çÂæÆÊúâÁÇπÊ∑∑‰π±Ôºå‰∏çÂ¶Ç cd Ë°•ÂÖ®ÂÆûÁî®
setopt AUTO_CD

#Êâ©Â±ïË∑ØÂæÑ
#/v/c/p/p => /var/cache/pacman/pkg
setopt complete_in_word

#Á¶ÅÁî® core dumps
limit coredumpsize 0

#‰ª•‰∏ãÂ≠óÁ¨¶ËßÜ‰∏∫ÂçïËØçÁöÑ‰∏ÄÈÉ®ÂàÜ
WORDCHARS='*?_-[]~=&;!#$%^(){}<>'
#}}}

#Ëá™Âä®Ë°•ÂÖ®ÂäüËÉΩ {{{
setopt AUTO_LIST
setopt AUTO_MENU
#ÂºÄÂêØÊ≠§ÈÄâÈ°πÔºåË°•ÂÖ®Êó∂‰ºöÁõ¥Êé•ÈÄâ‰∏≠ËèúÂçïÈ°π
#setopt MENU_COMPLETE

autoload -U compinit
compinit

#Ëá™Âä®Ë°•ÂÖ®ÁºìÂ≠ò
#zstyle ':completion::complete:*' use-cache on
#zstyle ':completion::complete:*' cache-path .zcache
#zstyle ':completion:*:cd:*' ignore-parents parent pwd

#Ëá™Âä®Ë°•ÂÖ®ÈÄâÈ°π
zstyle ':completion:*' verbose yes
zstyle ':completion:*' menu select
zstyle ':completion:*:*:default' force-list always
zstyle ':completion:*' select-prompt '%SSelect:  lines: %L  matches: %M  [%p]'

zstyle ':completion:*:match:*' original only
zstyle ':completion::prefix-1:*' completer _complete
zstyle ':completion:predict:*' completer _complete
zstyle ':completion:incremental:*' completer _complete _correct
zstyle ':completion:*' completer _complete _prefix _correct _prefix _match _approximate

#Ë∑ØÂæÑË°•ÂÖ®
zstyle ':completion:*' expand 'yes'
zstyle ':completion:*' squeeze-shlashes 'yes'
zstyle ':completion::complete:*' '\\'

#ÂΩ©Ëâ≤Ë°•ÂÖ®ËèúÂçï
eval $(dircolors -b)
export ZLSCOLORS="${LS_COLORS}"
zmodload zsh/complist
zstyle ':completion:*' list-colors ${(s.:.)LS_COLORS}
zstyle ':completion:*:*:kill:*:processes' list-colors '=(#b) #([0-9]#)*=0=01;31'

#‰øÆÊ≠£Â§ßÂ∞èÂÜô
zstyle ':completion:*' matcher-list '' 'm:{a-zA-Z}={A-Za-z}'

#ÈîôËØØÊ†°Ê≠£
zstyle ':completion:*' completer _complete _match _approximate
zstyle ':completion:*:match:*' original only
zstyle ':completion:*:approximate:*' max-errors 1 numeric

#kill ÂëΩ‰ª§Ë°•ÂÖ®
compdef pkill=kill
compdef pkill=killall
zstyle ':completion:*:*:kill:*' menu yes select
zstyle ':completion:*:*:*:*:processes' force-list always
zstyle ':completion:*:processes' command 'ps -au$USER'

#Ë°•ÂÖ®Á±ªÂûãÊèêÁ§∫ÂàÜÁªÑ
zstyle ':completion:*:matches' group 'yes'
zstyle ':completion:*' group-name ''
zstyle ':completion:*:options' description 'yes'
zstyle ':completion:*:options' auto-description '%d'
zstyle ':completion:*:descriptions' format $'\e[01;33m -- %d --\e[0m'
zstyle ':completion:*:messages' format $'\e[01;35m -- %d --\e[0m'
zstyle ':completion:*:warnings' format $'\e[01;31m -- No Matches Found --\e[0m'
zstyle ':completion:*:corrections' format $'\e[01;32m -- %d (errors: %e) --\e[0m'

# cd ~ Ë°•ÂÖ®È°∫Â∫è
zstyle ':completion:*:-tilde-:*' group-order 'named-directories' 'path-directories' 'users' 'expand'
#}}}

##Ë°åÁºñËæëÈ´ò‰∫ÆÊ®°Âºè {{{
# Ctrl+@ ËÆæÁΩÆÊ†áËÆ∞ÔºåÊ†áËÆ∞ÂíåÂÖâÊ†áÁÇπ‰πãÈó¥‰∏∫ region
zle_highlight=(region:bg=magenta #ÈÄâ‰∏≠Âå∫Âüü
special:bold      #ÁâπÊÆäÂ≠óÁ¨¶
isearch:underline)#ÊêúÁ¥¢Êó∂‰ΩøÁî®ÁöÑÂÖ≥ÈîÆÂ≠ó
#}}}

##Á©∫Ë°å(ÂÖâÊ†áÂú®Ë°åÈ¶ñ)Ë°•ÂÖ® "cd " {{{
user-complete(){
case $BUFFER in
"" )                       # Á©∫Ë°åÂ°´ÂÖ• "cd "
BUFFER="cd "
zle end-of-line
zle expand-or-complete
;;
"cd --" )                  # "cd --" ÊõøÊç¢‰∏∫ "cd +"
BUFFER="cd +"
zle end-of-line
zle expand-or-complete
;;
"cd +-" )                  # "cd +-" ÊõøÊç¢‰∏∫ "cd -"
BUFFER="cd -"
zle end-of-line
zle expand-or-complete
;;
* )
zle expand-or-complete
;;
esac
}
zle -N user-complete
bindkey "\t" user-complete
#}}}

##Âú®ÂëΩ‰ª§ÂâçÊèíÂÖ• sudo {{{
#ÂÆö‰πâÂäüËÉΩ
sudo-command-line() {
[[ -z $BUFFER ]] && zle up-history
[[ $BUFFER != sudo\ * ]] && BUFFER="sudo $BUFFER"
zle end-of-line                 #ÂÖâÊ†áÁßªÂä®Âà∞Ë°åÊú´
}
zle -N sudo-command-line
#ÂÆö‰πâÂø´Êç∑ÈîÆ‰∏∫Ôºö [Esc] [Esc]
bindkey "\e\e" sudo-command-line
#}}}
 
#[Esc][h] man ÂΩìÂâçÂëΩ‰ª§Êó∂ÔºåÊòæÁ§∫ÁÆÄÁü≠ËØ¥Êòé
alias run-help >&/dev/null && unalias run-help
autoload run-help
 
#ÂéÜÂè≤ÂëΩ‰ª§ top10
alias top10='print -l  ${(o)history%% *} | uniq -c | sort -nr | head -n 10'
#}}}

# install zplug, plugin manager for zsh, https://github.com/zplug/zplug
# curl -sL --proto-redir -all,https https://raw.githubusercontent.com/zplug/installer/master/installer.zsh | zsh
# zplug configruation
if [[ ! -d "${ZPLUG_HOME}" ]]; then
  if [[ ! -d ~/.zplug ]]; then
    # git clone https://github.com/zplug/zplug ~/.zplug
	curl -sL --proto-redir -all,https https://raw.githubusercontent.com/zplug/installer/master/installer.zsh | zsh
    # If we can't get zplug, it'll be a very sobering shell experience. To at
    # least complete the sourcing of this file, we'll define an always-false
    # returning zplug function.
    if [[ $? != 0 ]]; then
      function zplug() {
        return 1
      }
    fi
  fi
  export ZPLUG_HOME=~/.zplug
fi
if [[ -d "${ZPLUG_HOME}" ]]; then
  source "${ZPLUG_HOME}/init.zsh"
fi
zplug 'plugins/git', from:oh-my-zsh, if:'which git'
#zplug 'romkatv/powerlevel10k', use:powerlevel10k.zsh-theme
zplug "denysdovhan/spaceship-prompt", use:spaceship.zsh, from:github, as:theme
zplug "plugins/vi-mode", from:oh-my-zsh
zplug 'zsh-users/zsh-autosuggestions'
zplug 'zsh-users/zsh-completions', defer:2
zplug 'zsh-users/zsh-history-substring-search'
zplug 'zsh-users/zsh-syntax-highlighting', defer:2
 
if ! zplug check; then
  zplug install
fi
 
zplug load
 
#.# Better Git Logs.
### Using EMOJI-LOG (https://github.com/ahmadawais/Emoji-Log).
# Git Commit, Add all and Push ‚Äî in one step.
function gcap() {
    git add . && git commit -m "$*" && git push
}
# NEW.
function gnew() {
    gcap "üì¶ NEW: $@"
}
# IMPROVE.
function gimp() {
    gcap "üëå IMPROVE: $@"
}
# FIX.
function gfix() {
    gcap "üêõ FIX: $@"
}
# RELEASE.
function grlz() {
    gcap "üöÄ RELEASE: $@"
}
# DOC.
function gdoc() {
    gcap "üìñ DOC: $@"
}
# TEST.
function gtst() {
    gcap "‚úÖ TEST: $@"
}
 
# Colorful Man Page
export LESS_TERMCAP_mb=$'\e[1;32m'
export LESS_TERMCAP_md=$'\e[1;32m'
export LESS_TERMCAP_me=$'\e[0m'
export LESS_TERMCAP_se=$'\e[0m'
export LESS_TERMCAP_so=$'\e[01;33m'
export LESS_TERMCAP_ue=$'\e[0m'
export LESS_TERMCAP_us=$'\e[1;4;31m'
 
# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
[[ -f ~/.p10k.zsh ]] && source ~/.p10k.zsh
 
# Spaceship-prompt vi-mode
SPACESHIP_VI_MODE_SHOW=false

 # Perl
if ! [ -x "$(command -v perl)" ];then
  apt install perl -y
fi
